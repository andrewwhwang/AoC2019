from collections import defaultdict, deque
import numpy as np
from heapq import *

inputs="""         A           
         A           
  #######.#########  
  #######.........#  
  #######.#######.#  
  #######.#######.#  
  #######.#######.#  
  #####  B    ###.#  
BC...##  C    ###.#  
  ##.##       ###.#  
  ##...DE  F  ###.#  
  #####    G  ###.#  
  #########.#####.#  
DE..#######...###.#  
  #.#########.###.#  
FG..#########.....#  
  ###########.#####  
             Z       
             Z       """

inputs="""                                         R           L   A       D     U         R     S                                         
                                         W           H   C       B     F         Y     M                                         
  #######################################.###########.###.#######.#####.#########.#####.#######################################  
  #.#.........#.....#...#.......................#.#...#.....#.......#.....#.....#.....#.................#...#.#.#...........#.#  
  #.#####.###.#####.###.###.###.#######.#########.#.###.#######.###.#.#########.#.#######.#####.###.#.#.###.#.#.#.###.#.#####.#  
  #.......#...#.#.#...#.#...#.#.#...#.#.....#.#...#...#.......#.#...#.......#...#.#...........#...#.#.#.............#.#.#.#...#  
  #.###.###.#.#.#.#.###.#####.#####.#.###.###.#.#.###.###.#####.###.###.#######.#.###.###.#.#####.###.#######.#####.#####.###.#  
  #.#.#.#...#.#.#.........#.....#...........#...#.....#...#.#...#...#.........#...#...#.#.#...#.#.#.#.#...#.#.#.#.............#  
  #.#.#######.#.#######.#####.###.#####.###.###.#######.###.#####.#.#.#######.###.#.###.#####.#.###.###.###.###.#######.#######  
  #.#...#...................#.#.#.#.....#.....#...#.......#.....#.#.#.....#...#.#.#.........#...#.#...#.#.........#...#.#.....#  
  ###.#####.###.#.#.#.###.###.#.###.###.#.#.#####.###.#.#####.#.#.###.#.#######.#.#.###.#.#.#.#.#.###.#.#.#####.###.#######.###  
  #...#.#...#.#.#.#.#.#.#...#...#...#...#.#.#.....#...#.#...#.#.#...#.#.#.....#...#...#.#.#.#.#.#.#.#.....#.#.#.#.......#.#.#.#  
  ###.#.#####.#####.###.#.#.#.#########.#######.#.###.#.###.#.#.###.#.#.#.#######.#.###########.#.#.#.#.###.#.###.#.#.#.#.#.#.#  
  #.#.....#...........#...#...........#.#...#...#.#.#.#...#...#.....#.#...#.#...#.#.......#...#.#.#...#.#.#.......#.#.#.#.#...#  
  #.###.#####.#######################.#.#.#####.###.###.#####.#######.###.#.#.#.#.#.#########.###.###.###.#.#####.#######.###.#  
  #.#...#.....#.............#...........#.#.#.........#.#.........#...#...#...#.#.#.#.#...#...#...............#.....#.#.#...#.#  
  #.###.#####.###.#.#######.#########.#.#.#.###.#####.#.#####.#.#.#######.#.#.###.#.#.#.#####.###.#.#.#.###.#.#####.#.#.#.###.#  
  #.#...#.......#.#.#.......#...#...#.#.....#.....#...#.#.#.#.#.#...#.....#.#.....#.........#.#...#.#.#.#.#.#.#...#.#.#.......#  
  #.#.#.#####.#########.###.#.#####.#####.#####.#######.#.#.#.#.###.#.###.#.#.#.#.###.#####.#.#.#.#.#####.#####.#####.#.###.###  
  #.#.#...#.#.#.#.....#.#.................#...........#.....#.#.#...#.#.#.#.#.#.#.#.......#.#.#.#.#.#.........#.......#.#.....#  
  #.#.#####.###.#.###.###########.#.###.#########.#######.#########.#.#.#########.#.#########.#.#####.###.#########.#######.###  
  #.....#...#.#.#.#...#...#.....#.#.#...#.#.#.#.#...#.........#.....#.....#.......#.....#.#.#.....#.....#.#.#.#.......#.#...#.#  
  #.#######.#.#.#####.#.#.###.###.#####.#.#.#.#.#.#####.#########.###.#####.###.###.#.###.#.#.###.#.#######.#.###.#####.###.#.#  
  #.#.......#.#.#.#.#.#.#.........#...#.#.#...#...#...#.#.#...#.....#...#...#.#.#.#.#...#...#.#...........#...#.#.#.#.....#...#  
  #.#.#######.#.#.#.#.###.###.#####.#.#.#.#.#.#.###.#.#.#.#.#######.#.#######.#.#.#.#.###.###.###.#.#########.#.#.#.#####.#.###  
  #.#.....#.#...........#.#.......#.#.....#.#.#.....#.#.........#...#...#.#.......#.#...........#.#.#.#.#.#.#.#.....#.#.......#  
  #.#.#####.#.#######.#####.#.#########.###.#.#######.#.#####.###.#.#.#.#.###.###.###.###.###########.#.#.#.#.#.###.#.#.#####.#  
  #.....#...#.#...#.#.#.#...#.....#.....#...#...#.....#.#.#.....#.#.#.#.#...#...#...#.#.....#.....#.#.#.#.....#.#...#.#.#.#.#.#  
  #.#####.#.#####.#.#.#.#####.#########.#.###.###.#####.#.#########.#.###.#######.#######.#.#.#.###.#.#.#####.#####.#.#.#.#.###  
  #.#...#.#.#.#.#.......#.#...#...#.......#.#...#.....#.......#.....#...........#...#.#.#.#...#.........#.....#...#.......#.#.#  
  #.#.#.###.#.#.#######.#.#####.#.#.###.#####.###.#.###.#########.#####.#.#.#####.###.#.#.###.###.#.#.###.###.#.###.#.#####.#.#  
  #.#.#.#.#.....#.#.#.#.....#.#.#...#...#...#.#...#.#.....#.#...#.....#.#.#.#.#...#.......#...#...#.#...#.#.#...#...#.#.#.....#  
  #.#.###.#.#####.#.#.#####.#.###########.###.#.###.###.###.#.#.###.#####.###.###.#.###########.###########.#.#######.#.###.#.#  
  #.....#.#.#.#.......#.#...#...#.#.....#...#.#.#.#.#.....#...#...#...#.#.#.....#.#.......#...#.#...#.#.......#...#.#...#...#.#  
  #.#####.#.#.#######.#.#.#####.#.###.#####.#.#.#.#####.###.#######.###.#.###.###.###.###.#.#######.#.#####.#.#.###.#.#####.###  
  #...#.....#...#.#...#...#.#.................#.......#.......#.......#...#.......#...#.....#.#...#...#.....#.#...#...#.#...#.#  
  #.#####.#####.#.###.#.#.#.#####.#########.#######.#######.###.#########.#.#######.#########.###.#.###.###.###.###.###.#.#.#.#  
  #.....#...#...#.......#.#.#.#...#.#      G       U       S   L         N D       R        #...#.#...#.#...#.......#.....#.#.#  
  #.#####.#####.#####.#.###.#.#####.#      T       O       M   H         A M       Y        ###.#.###.#####.#####.#.###.#####.#  
  #.....#...#...#.....#.#.#...#...#.#                                                       #.#.#...#.#.#.......#.#...#.#...#.#  
  #.#####.###.#######.#.#.#.#####.#.#                                                       #.#.#.###.#.###.#.#######.#.#.###.#  
  #.#...#.#...#.....#.#.#.#.#.......#                                                     OL....#.....#.#...#.#.....#.......#.#  
  #.###.#.#.#####.#####.#.#.###.#.###                                                       ###.#.#.###.#.#########.###.#.###.#  
  #.#.#.........#...#.......#...#.#.#                                                       #...#.#.......#.#...#.....#.#.#...#  
  #.#.###.###.###.#######.###.#####.#                                                       #.###.#####.###.#.#####.###.#.#.###  
DN..#.......#.#.#.#.#.......#.#.#.#.#                                                       #...#...#...#.......#.......#.#....CU
  #.#.###.#####.#.#.###.###.#.#.#.#.#                                                       ###.#.#####.#####.#####.#####.#.#.#  
  #.#...#.....#.#...#...#.........#.#                                                       #.........#...............#.#...#.#  
  #.###.#.#####.###.###.#.#####.###.#                                                       #############.#############.#####.#  
ZZ..#...#...#...#.#.....#.....#.#...#                                                       #...........#.#.......#.........#.#  
  #.#.#####.#.#.#.#.###.#####.#####.#                                                       #.#.###.###.###.###.#######.###.#.#  
  #.....#.....#.....#.....#..........HN                                                     #.#.#...#.........#.........#...#.#  
  #################.#####.###########                                                       #.###.#.#.###.###.#.###.###.#.#####  
  #...#.#.#.#.....#.....#.#...#.....#                                                     TG..#.#.#.#.#.....#.#...#.#...#.#....NA
  ###.#.#.#.#.#.#####.#.###.#.#.###.#                                                       ###.###.###.#######.#########.###.#  
YC..#.......#.#.....#.#.#...#...#.#..DN                                                     #.....#.#.#.#.#...#.#...#.........#  
  #.#####.#.#.###.#######.###.###.#.#                                                       #####.###.###.#.#######.#######.#.#  
  #...#...#.#...#.#...#.....#.#...#.#                                                     YC..#...#.........#...#.....#...#.#.#  
  ###.#.###.###.#.#.#.#####.#####.###                                                       #.#.#.#.#####.#.#.#.#.#.###.#####.#  
  #.#...#.#.....#...#.......#.......#                                                       #.#.#.#...#.#.#...#...#.....#.#...#  
  #.#####.#####################.#####                                                       #.#.#.#.###.###.###.#.#.###.#.#####  
  #.......#...#.........#.....#.#.#.#                                                       #...#.......#.#.#...#.#.#.....#....JS
  #.###.###.#.#.#####.#.#.#.###.#.#.#                                                       #.###########.#.#######.#.###.#.###  
  #.#.......#.....#...#...#...#......YF                                                     #...#.....#...#.#.....#.#.#.#...#.#  
  #.###.#.#.###.#####.#.#.#.#.#.#.#.#                                                       #######.#####.#####.#######.###.#.#  
  #...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#                                                       #.......#.......#...#...#.....#.#.#  
  #.#######.#.#.###.#####.###.#.#####                                                       ###.#.#.###.###.#.#.#.#.#.###.###.#  
DM..#.#.#...#.#...#.#...#.#.....#...#                                                       #.#.#.#...#.#.....#.#.#.#.#.....#..YF
  #.#.#.#####.#####.#.###########.###                                                       #.#.#####.#.###.#.#.#.#.#.#####.#.#  
  #.#.....#...................#.....#                                                     CD..#...#.......#.#.#.#.#.#...#...#.#  
  ###.#.#########.#.###.#####.#.###.#                                                       #.#.#######.#######.#.#.###.#.###.#  
OL....#...........#...#.#.....#.#.#..TK                                                     #.....#.#.#.#.........#.....#.....#  
  #.###.#######.#.#.###.###.###.#.#.#                                                       #######.#.#####################.###  
  #.#...#.#.#...#.#.#...#.......#...#                                                       #...#.......#...#.....#.......#.#.#  
  #.#####.#.#########.#######.###.###                                                       #.#.###.###.###.###.#.#.#.#.#.###.#  
CD..#.#.#.....#.#.#...#.#...#...#....UF                                                     #.#.#...#...........#.#.#.#.#...#..GT
  ###.#.###.###.#.###.#.#.###.###.###                                                       ###.###.###.#####.###.#.###.#.###.#  
  #.................#.#.....#...#.#.#                                                     JS..#.....#.....#.#...#.....#.#.#...#  
  #.#####.#######.#####.#.#.#.#####.#                                                       #.#.#.#.#######.#####.#.#####.#.###  
  #.....#.#...#...#.....#.#.#.#.#.#..AC                                                     #...#.#.#.#.#.#...#...#...#.#...#.#  
  #####.#######.#.###.#.#######.#.#.#                                                       #########.#.#.#.###########.#####.#  
  #...#.#.......#.#...#...#.....#...#                                                       #...#.....#.......#.#.............#  
  #.###.#####.#######.###.#.#.#.#.###                                                       ###.#.#.###.#.#.###.#.###.#.###.###  
BM......#.............#.#...#.#.....#                                                       #.....#.....#.#.#...#.#.#.#.#...#.#  
  ###########.#.#######.#############                                                       #.#######.#.#.#####.###.#.#.###.#.#  
DH..#.......#.#.#...........#.....#.#                                                       #.....#...#.#.....#.#...#.#...#....UO
  #.#.#####.#####.#.###.#######.#.#.#                                                       ###.###.#####.#####.###.#####.#.###  
  #.#...#.......#.#.#.....#...#.#...#                                                     BM......#.#.....................#...#  
  #.###.#######.#.#.###.###.###.###.#                                                       #################################.#  
  #...#.....#...#.#.#...#...#...#...#                                                       #.......#.............#.........#.#  
  #.#.#.#####.###.#.###.#.#.#.###.###                                                       #.#####.###.#####.###.#.#.#.#.#####  
  #.#.....#.......#.#.....#...#.#....CU                                                   GN......#.#...#.#...#.#.#.#.#.#.....#  
  #.#.###.#.#####.#####.#####.#.#.#.#                                                       #######.#.###.###.#.#.#.#####.#.###  
  #.#.#...#.#.#.....#.#...#.....#.#.#                                                       #.#.....#.......#.#.........#.#....OY
  #.#.#######.#.#####.#.#.#####.#####                                                       #.#.#########.#########.#.#.###.#.#  
  #.#...#.........#.....#.#.........#                                                       #.................#.#...#.#...#.#.#  
  #####.#######.#.###.###.#.#.###.#.#    X         O           D D         R     K          #####.#.###.###.#.#.###.###.###.###  
  #...#.......#.#.#.#...#.#.#.#...#.#    M         Y           H B         W     N          #.....#...#.#.#.#.#.......#...#...#  
  #.###.#####.###.#.#.#.#.###.#.#.#######.#########.###########.#.#########.#####.###########.#.#.#.#.#.#.#.#.###.#####.###.###  
  #.........#...#...#.#.#...#.#.#...#.......#.....#.....#.#.....#...#.#.#...#...........#...#.#.#.#.#.#...#.#.#.......#.#.#...#  
  ###.#.#####.#######.#.###.###.#.#######.###.#.#####.###.#####.#.###.#.#.#############.###.###.###.#.#.#.#######.#####.#.#.###  
  #.#.#...#...#.......#...#...#.#.#.........#.#.#.......#.......#...#...#.....#.#.#...........#.#...#.#.#.....#.#...#.....#...#  
  #.###.#.#.#####.###.#.###.#.#####.#####.#.#.#.#.#####.#.#.#######.#.#.#.#####.#.#.#.#.#.#.#.#.###.#########.#.#######.###.#.#  
  #.....#.#.....#.#...#.#.#.#.#...#.#.....#...#.#.#.....#.#.....#.....#.#.......#...#.#.#.#.#.#.#.#.........#.#...........#.#.#  
  #####.###.#.#.#.###.###.#####.#.###.#########.###.#.###.#######.#.###.#######.#.#########.###.#.#.#####.#####.#.###.#.#.#.#.#  
  #.#.....#.#.#.#...#.#.#.#.#.#.#...#.#.........#...#.#.#.......#.#.#...#.#.....#.......#.....#.#.....#.......#.#.#...#.#.#.#.#  
  #.#.#.###.#.#####.###.#.#.#.#.#########.#.#.###.#####.#.#######.#.###.#.###.#####.#.#######.###.###.#########.#.###.#.#####.#  
  #...#...#.#.#.#...#.#.......#...#.#.#.#.#.#.#...#.....#.#.#.#.#.#.#...#.....#.#...#.....#.....#.#...........#.#...#.#...#...#  
  #.###.#######.#####.#####.###.#.#.#.#.###.#####.#.###.#.#.#.#.#######.#.#.###.#####.#.#.###.#########.#.#.#######.#.###.###.#  
  #.#.........#.#.#...#.....#...#...........#.#.....#...#...#...#...#...#.#...#.......#.#...#...#.#.....#.#.#.#.#.#.#...#.#...#  
  #.###.###.###.#.###.#.#.#.#####.###.#####.#.#######.###.###.###.#####.#.#######.#.#.###########.###.#.###.#.#.#.###.#.###.#.#  
  #.#...#.........#.....#.#...#.....#.#.........#.....#.....#.#.#.#.....#.....#...#.#...#.#...#...#.#.#.#...........#.#.#...#.#  
  #.#.#.#####.#.#############.###.###.#####.#.#.#.###.###.###.#.#.#####.###.###.#.###.###.#.###.###.#.#####.#.#.#.#.###.#####.#  
  #.#.#...#...#.#...#.............#.#.#.....#.#.#.#...#...............#.#...#.#.#.#.#.......#.#.#.#.....#...#.#.#.#...#...#...#  
  #.###.###.#####.#.#.###.#########.###########.#.###.###.###.#.#######.#.#.#.###.#.###.###.#.#.#.###.#####.###.#########.###.#  
  #.#.....#.....#.#...#...#.....#.#.#...#.......#...#.#.#.#.#.#...#.#...#.#.....#...#.#...#.#.......#.#.....#.......#.......#.#  
  #.###.#####.#####.###.#.#####.#.#.###.#####.###.#####.#.#.#######.###.#.#######.###.###.###.#.###########.#####.###.#.#.#.###  
  #.#...#.....#.....#...#.#.#.......#.#...#.#...#.....#.........#.#.....#.....#.......#.#.#...#.#...#.#.#.....#...#.#.#.#.#.#.#  
  #.#.#.#############.#####.###.#.###.###.#.###.###.#####.#######.#####.#.#.#####.#####.#.#####.###.#.#.#.###.###.#.#.###.###.#  
  #.#.#.#...#.#.#.......#.......#.....#...#.....#.......#.....#.........#.#.#...#.#.#.....#.#...........#...#.#.#...#.#.......#  
  #.#######.#.#.###.###########.#.###.###.###.###.#.#####.###########.###.#####.#.#.#####.#.#.#####.#.###.#.###.###.###.#####.#  
  #.#.#...#...#.#.#.#.#.#.#.#.#.#.#.........#.#...#...#...#...#.......#.........#.#.#...#.#.......#.#...#.#...#...#.#.......#.#  
  #.#.#.#####.#.#.###.#.#.#.#.#.###.#####.#.#.###.#####.#.###.###.#.#######.#####.#.#.#####.#####.###.###.#####.#####.#.#######  
  #...#.....#...#...#...........#...#.....#.....#.....#.#.......#.#.#...#.....#.#...#.......#.#...#.#...#.#.........#.#.......#  
  #.#######.###.###.###.#.###############.#######.###.#.#.#########.###.#.#.###.#.###.#.#####.#####.#####.###.###.#######.#.#.#  
  #.#...#.............#.#.#.#...................#.#.#.#.#.....#.#.......#.#.#.#...#...#.....#.#...#.....#.#.#.#.#...#.#...#.#.#  
  #.###.###.#.###.#########.###.#######.###.###.#.#.#.#####.#.#.#######.#.###.###.#.###.#####.#.#######.###.#.#.#####.#.#.#.###  
  #.#.#.#...#.#.......#.........#.......#.....#.#.#.#.#.#...#.#.......#.#.......#.#...#.#.#.......#.................#...#.#...#  
  ###.#.#.#########.#.###.#.###.###.#####.###.#####.#.#.#.#######.#.###.#.###.###.#.#####.###.#.###.#######.#####.#.#.###.#.#.#  
  #...#...#.........#.....#.#...#...#.#.....#.#.#.....#...#.....#.#.#...#...#.#...............#...........#.....#.#.#.#...#.#.#  
  #.#.###.#.#####.###.#.#.#.###.#.###.#.###.###.#.#####.#.#.###.#.#.#.###.#####.###.#.#.###.###.###.#.#######.#########.#.#.###  
  #.#.....#.#.....#...#.#.#...#.#.#.....#.......#.....#.#...#...#.#...#.......#.#...#.#...#.#.....#.#.......#.......#...#.#...#  
  #########################################.#######.#######.###.#.###########.#####.###########################################  
                                           T       T       A   G K           X     H                                             
                                           K       G       A   N N           M     N                                             """

class Portal:
    def __init__(self, name):
        self.name = name
        self.adj = {}
        # self.loc = loc

    def __repr__(self):
        return self.name

    def __lt__(self, value):
        return False
        
def dijkstra(start, target):
    visited =  set()
    mins = {start: 0}
    queue = [(-1,start,())]
    while queue:
        (cost,v1,path) = heappop(queue)
        if v1 not in visited:
            visited.add(v1)
            path = (*path, v1)
            if v1 == target: 
                return (cost, path)

            for v2, c in v1.adj.items():
                if v2 in visited: continue
                prev = mins.get(v2, None)
                nxt = cost + c
                if prev is None or nxt < prev:
                    mins[v2] = nxt
                    heappush(queue, (nxt, v2, path))

    return float("inf")

def getArray2D(inputs):
    lines =  inputs.split("\n")
    array2D = np.zeros((len(lines),len(lines[0])),dtype="U")
    for i, line in enumerate(lines):
        array2D[i] = list(line)
    return array2D

def getPortalLoc(array2D):
    portals = {}
    portalNames = {}
    for coord, char in np.ndenumerate(array2D[:-1,:-1]):
        row, col = coord
        if not char.isalpha():
            continue

        if array2D[row,col+1].isalpha() or array2D[row+1,col].isalpha():
            loc = (0,0)
            start, i = lambda delta: (row, col+delta), 1
            if array2D[row+1,col].isalpha():
                start, i = lambda delta: (row+delta, col), 0

            name = char+array2D[start(1)]
            if coord[i] == 0:
                loc = start(2)
            elif coord[i] == array2D.shape[i] - 2:
                loc = start(-1)
            else:
                if array2D[start(-1)] == '.':
                    loc = (start(-1))
                elif array2D[start(2)] == '.':
                    loc = (start(2))
            if name not in portalNames:
                portalNames[name] = Portal(name)
            portals[loc] = portalNames[name]

    return portals

def BFS(startLoc, array2D, portals):
    visited = {startLoc}
    queue = deque([startLoc, "end"])
    distance = 1

    while queue:
        loc = queue.popleft()

        if loc in portals:
            yield distance, portals[loc]

        if loc == "end":
            distance += 1
            queue.append("end")
            # stop if two "end"s in a row
            if queue[0] == "end":
                return
        else:
            for adj in [(loc[0]+i, loc[1]+j) for i, j in zip([-1,0,1,0],[0,1,0,-1])]: 
                if adj not in visited and array2D[adj]=='.':
                    queue.append(adj)
                    visited.add(adj)

def setAdj(array2D, portalLocs):
    start, end = None, None
    for loc, portal in portalLocs.items():
        distances = {}
        for dist, adjPortal in BFS(loc, array2D, portalLocs):
            distances[adjPortal] = min(dist,distances.get(adjPortal,float('inf')))
        del distances[portal]
        portal.adj = {k : min(i for i in (portal.adj.get(k), distances.get(k)) if i) for k in portal.adj.keys() | distances}
        
        if portal.name == "AA":
            start = portal
        elif portal.name == "ZZ":
            end = portal

    return start, end

array2D = getArray2D(inputs)
portalLocs = getPortalLoc(array2D)
start, end = setAdj(array2D, portalLocs)
print(dijkstra(start, end))

for portal in set(portalLocs.values()):
    print(portal, portal.adj)